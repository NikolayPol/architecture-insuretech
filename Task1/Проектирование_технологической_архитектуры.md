# Проектирование высоконагруженной отказоустойчивой архитектуры    
 
Требования:     
- RTO(Recovery Time Objective) — максимальное время недоступности инфраструктуры 45 мин;     
- RPO(Recovery Point Objective) — допускается потеря данных не более чем за последние 15 мин;   
- Доступность приложения должна быть равна 99,9%;   
- Обеспечить одинаковое время загрузки страниц для пользователей из разных регионв, 
оно не должно зависеть от географического местоположения пользователя;        

Есть два основных типа failover(аварийное переключение)-стратегии:      
- Active-Active - приложение разворачивается как минимум на двух серверах, и трафик идет на все;        
- Active-Standby(Passive) - приложение разворачивается как минимум на двух серверах, при этом трафик идет на один сервер, второй - 
  находится в режиме ожидания с минимальной утилизацией ресурсов на случай отказа первого.    

Для требования доступности приложения 99,9% подходит статегия Active-Active, поскольку Active-Passive стратегия имее более низкую 
доступность по причине задержки, связанной с активацией резервного сервера.   

Для балансировки нагрузки между разными ЦОДами, которые находятся в разных географических зонах, используется Global Server Load Balancer(GSLB) с георезервированием.  

Для обеспечения отказоустойчивости и высокой доступности приложения применяется распределенный кластер Kubernetes 
с горизонтальным масштабированием и с встроенным балансировщиком нагрузки.        
Для обеспечения отказоустойчивости и высокой доступности БД применяется распределенный кластер PostgreSql на основе Patroni с горизонтальным масштабированимем.    
Подключение к кластеру БД осуществляется через балансировщик HAProxy, который определяет master ноду через обращение на API Patroni. 
HAProxy также разворачивается в резервной конфигурации.        

![architecture.png](architecture.png)





